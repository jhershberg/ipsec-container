apiVersion: v1
kind: Pod 
metadata:
  name: ipsec-left-0
  labels:
    run: ipsec-left 
spec:
  terminationGracePeriodSeconds: 5
  containers:
  - name: ipsec-left
    image: mangelajo/ipsec-container
    securityContext:
      capabilities:
        add: ["NET_ADMIN"]
      allowPrivilegeEscalation: true
      privileged: true
      runAsUser: 0
    env:
    - name: REMOTE_IP
      value: 38.145.35.46
    - name: VXLAN_PORT
      value: "30020"
    - name: IPSEC_SIDE
      value: left
    livenessProbe:
      exec:
        command:
        - sh
        - -c
        - ip a show dev vti01 | grep 169.254.1 && ping -W 2 -c 1 169.254.1.2
      initialDelaySeconds: 30
      periodSeconds: 10 
      timeoutSeconds: 3
    readinessProbe:
      exec:
        command:
        - sh
        - -c
        - ip a show dev vti01 | grep 169.254.1 && ping -W 2 -c 1 169.254.1.2
      initialDelaySeconds: 5
      periodSeconds: 3 
      timeoutSeconds: 2
      successThreshold: 1
      failureThreshold: 1
    ports:
    - containerPort: 30020
      hostPort: 30020
      protocol: UDP
    - containerPort: 100
    - containerPort: 101
    - containerPort: 102
    - containerPort: 103
    - containerPort: 104
    - containerPort: 105
    - containerPort: 106
    - containerPort: 107
    - containerPort: 108
    - containerPort: 109
    - containerPort: 110
    - containerPort: 111
    - containerPort: 112
    - containerPort: 113
    - containerPort: 114
    - containerPort: 115
    - containerPort: 116
    - containerPort: 117
    - containerPort: 118
    - containerPort: 119
